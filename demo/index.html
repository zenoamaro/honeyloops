<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Honeyloops demo</title>
	<script src="../honeyloops.js"></script>
	<script src="jquery.js"></script>
	<script src="underscore.js"></script>
	<script src="backbone.js"></script>
</head>
<body>
	<p id="best-friend">Best friend: <span class="name"></span></p>
	<p id="worst-friend">Worst friend: <span class="name"></span></p>

	<script>(function(){

		var log = function() {
			if (window.logging && window.console)
				console.log.apply(console, arguments);
		}

		logging = true;

		BoundView = Backbone.View.extend({

			dirty: true,
			bindings: {},

			initialize: function(options) {
				if (options.bindings)
					this.bindings = options.bindings;
				_.bindAll(this, 'changed', 'render')
				HoneyLoops.register(this.render);
				this.listenTo(this.model, 'change', this.changed);
			},

			changed: function() {
				var attrs = model.changedAttributes() || model.attributes;
				for (var k in attrs) if (k in this._bindings)
					return this.dirty = true;
			},

			cacheBindings: function() {
				this._bindings = {};
				for (var b in this.bindings)
					this._bindings[this.bindings[b]] = this.$(b);
			},

			render: function() {
				if (!this.dirty)
					return;
				log('Rendering view `' + this.cid + '`')
				if (!this._bindings)
					this.cacheBindings();
				for (var b in this._bindings)
					this._bindings[b].html(
						this.model.get(b));
 				this.dirty = false;
			}
		});

		model = new Backbone.Model({
			'best-friend': 'Philip',
			'worst-friend': 'Frank'
		});

		bestFriendView = new BoundView({
			model: model,
			el: $('#best-friend'),
			bindings: { '.name': 'best-friend' }
		});

		worstFriendView = new BoundView({
			model: model,
			el: $('#worst-friend'),
			bindings: { '.name': 'worst-friend' }
		});

		HoneyLoops.start();

		console.info(
			'%cThe two views are each bound onto one of the paragraphs,\n'+
			'and displays one attributes only from the model.\n\n'+
			'Try to update the model doing, for instance:\n\n'+
			'    model.set("best-friend", "Stevens");\n\n'+
			'and watch the affected view update.\n\n'+
			'Enable or disable logging by switching `window.logging`\n'+
			'on or off.\n\n', 'color:blue'
		);

	})();</script>
</body>
</html>
